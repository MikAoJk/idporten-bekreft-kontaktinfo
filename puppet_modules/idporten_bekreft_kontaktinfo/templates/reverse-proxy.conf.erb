# reverse proxy & ssl offloader for nginx
server {

  listen <%= scope['bekreft_kontaktinfo_web::nginx_ssl_port'] %> ssl http2 reuseport;
  listen [::]:<%= scope['bekreft_kontaktinfo_web::nginx_ssl_port'] %> ssl http2 reuseport;

  ssl_certificate <%= scope['bekreft_kontaktinfo_web::nginx_ssl_path'] %>/wildcard<%= scope['domain_with_leading_dot'] %>.crt;
  ssl_certificate_key <%= scope['bekreft_kontaktinfo_web::nginx_ssl_path'] %>/wildcard<%= scope['domain_with_leading_dot'] %>.key;

  server_name _;
  autoindex off;

  default_type text/plain;

   location / {
        proxy_pass      http://127.0.0.1:<%= scope['bekreft_kontaktinfo_web::server_port'] %>$uri;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
   }

   gzip on;
   gzip_types text/plain text/xml text/css text/html application/javascript;

}
